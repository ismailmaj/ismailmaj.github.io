<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.20.0"/><meta data-react-helmet="true" name="description" content="The costs of laziness"/><meta data-react-helmet="true" name="image" content="https://ismailmaj.github.io/banner.jpg"/><meta data-react-helmet="true" property="og:title" content="The costs of laziness"/><meta data-react-helmet="true" property="og:url" content="https://ismailmaj.github.io/the-costs-of-laziness"/><meta data-react-helmet="true" property="og:description" content="The costs of laziness"/><meta data-react-helmet="true" property="og:image" content="https://ismailmaj.github.io/banner.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image:alt" content="The costs of laziness"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="The costs of laziness"/><meta data-react-helmet="true" name="twitter:url" content="https://ismailmaj.github.io/the-costs-of-laziness"/><meta data-react-helmet="true" name="twitter:description" content="The costs of laziness"/><meta data-react-helmet="true" name="twitter:image" content="https://ismailmaj.github.io/banner.jpg"/><meta data-react-helmet="true" name="twitter:image:alt" content="The costs of laziness"/><meta data-react-helmet="true" name="twitter:creator" content="Ismail Maj"/><meta data-react-helmet="true" name="gatsby-theme" content="@lekoarts/gatsby-theme-minimal-blog"/><title data-react-helmet="true">The costs of laziness | </title><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&amp;display=swap"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png"/><link rel="apple-touch-icon" sizes="512x512" href="/android-chrome-512x512.png"/><link rel="alternate" type="application/rss+xml" title="Minimal Blog - @lekoarts/gatsby-theme-minimal-blog" href="/rss.xml"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global 1yc3m30">html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#e2e8f0;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-__default,.theme-ui-__default html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#e2e8f0;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-primary:#9f7aea;--theme-ui-colors-secondary:#7f8ea3;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-muted:#2d3748;}</style><style data-emotion="css-global 1j0yc2g">*{box-sizing:border-box;}html{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);margin:0;padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}body{margin:0;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global h7esfd">*{box-sizing:inherit;}html{-webkit-text-size-adjust:100%;}img{border-style:none;}pre{font-family:monospace;font-size:1em;}[hidden]{display:none;}::selection{background-color:var(--theme-ui-colors-text);color:var(--theme-ui-colors-background);}a{-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;color:text;}</style><style data-emotion="css 1gq7j3t">.css-1gq7j3t{border:0;clip:react(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute;}.css-1gq7j3t:focus{padding:1rem;position:fixed;top:15px;left:15px;background-color:var(--theme-ui-colors-heading);color:var(--theme-ui-colors-background);z-index:1;width:auto;height:auto;clip:auto;-webkit-text-decoration:none;text-decoration:none;}</style><a href="#skip-nav" data-skip-link="true" class="css-1gq7j3t">Skip to content</a><style data-emotion="css 1jrqzhj">.css-1jrqzhj{box-sizing:border-box;margin:0;min-width:0;width:100%;max-width:container;margin-left:auto;margin-right:auto;padding:1rem;max-width:1024px;}@media screen and (min-width: 640px){.css-1jrqzhj{padding:2rem;}}</style><div class="css-1jrqzhj"><style data-emotion="css egutgn">.css-egutgn{margin-bottom:4rem;}@media screen and (min-width: 640px){.css-egutgn{margin-bottom:8rem;}}</style><header class="css-egutgn"><style data-emotion="css 1xwyizx">.css-1xwyizx{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><style data-emotion="css 10klvkd">.css-10klvkd{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><div class="css-10klvkd"><style data-emotion="css uxjqfw">.css-uxjqfw{color:var(--theme-ui-colors-heading);-webkit-text-decoration:none;text-decoration:none;}</style><a aria-label=" - Back to home" class="css-uxjqfw" href="/"><style data-emotion="css 102q2va">.css-102q2va{margin-top:0;margin-bottom:0;font-weight:500;font-size:1.5rem;}@media screen and (min-width: 640px){.css-102q2va{font-size:1.875rem;}}</style><div class="css-102q2va"></div></a><style data-emotion="css zut31r">.css-zut31r{opacity:0.65;position:relative;border-radius:5px;width:40px;height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;border:none;outline:none;background:none;cursor:pointer;padding:0;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;}.css-zut31r:hover,.css-zut31r:focus{opacity:1;}</style><button type="button" aria-label="Activate Dark Mode" title="Activate Dark Mode" class="css-zut31r"><style data-emotion="css 1m6u41m">.css-1m6u41m{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all 0.45s ease;transition:all 0.45s ease;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon);}.css-1m6u41m:before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0);opacity:1;-webkit-transition:-webkit-transform 0.45s ease;transition:transform 0.45s ease;}.css-1m6u41m:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon),0 23px 0 var(--theme-ui-colors-toggleIcon),23px 0 0 var(--theme-ui-colors-toggleIcon),-23px 0 0 var(--theme-ui-colors-toggleIcon),15px 15px 0 var(--theme-ui-colors-toggleIcon),-15px 15px 0 var(--theme-ui-colors-toggleIcon),15px -15px 0 var(--theme-ui-colors-toggleIcon),-15px -15px 0 var(--theme-ui-colors-toggleIcon);-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transition:all 0.35s ease;transition:all 0.35s ease;}</style><div class="css-1m6u41m"></div></button></div><style data-emotion="css fp1v3n">.css-fp1v3n{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:var(--theme-ui-colors-divide);padding-bottom:1rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-top:1rem;color:var(--theme-ui-colors-secondary);-webkit-box-flex-flow:wrap;-webkit-flex-flow:wrap;-ms-flex-flow:wrap;flex-flow:wrap;}.css-fp1v3n a{color:var(--theme-ui-colors-secondary);}.css-fp1v3n a:hover{color:var(--theme-ui-colors-heading);}</style><div class="css-fp1v3n"><style data-emotion="css 1lx5s1f">.css-1lx5s1f{font-size:1rem;}.css-1lx5s1f a:not(:last-of-type){margin-right:1rem;}@media screen and (min-width: 640px){.css-1lx5s1f{font-size:18px;}}.css-1lx5s1f .active{color:var(--theme-ui-colors-heading);}</style><nav class="css-1lx5s1f"><style data-emotion="css bpdkdn">.css-bpdkdn{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-bpdkdn:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-bpdkdn" href="/blog">Post</a><a class="css-bpdkdn" href="/tags">Tags</a></nav><style data-emotion="css 45ghvz">.css-45ghvz{font-size:1rem;}.css-45ghvz a:not(:first-of-type){margin-left:1rem;}@media screen and (min-width: 640px){.css-45ghvz{font-size:18px;}}</style><div class="css-45ghvz"><style data-emotion="css 1fmmdck">.css-1fmmdck{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-1fmmdck:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="/" class="css-1fmmdck">About</a><a href="https://github.com/ismailmaj" class="css-1fmmdck">Github</a><a href="https://linkedin.com/in/ismailmaj" class="css-1fmmdck">Linkedin</a><a href="mailto:ismailmaj98@gmail.com" class="css-1fmmdck">Email</a></div></div></header><style data-emotion="css daw71u">.css-daw71u [data-name='live-editor']{font-size:1rem;}.css-daw71u [data-name='live-editor'] textarea,.css-daw71u [data-name='live-editor'] pre{padding:1rem!important;}.css-daw71u [data-name='live-preview']{padding:calc(0.5rem + 10px)!important;background-color:#d2c7ec;}.css-daw71u .prism-code{font-size:1rem;padding:2rem 1rem 1rem 1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-daw71u .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-daw71u .prism-code{font-size:1.25rem;}}.css-daw71u .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-daw71u .gatsby-highlight[data-language=''] .prism-code,.css-daw71u .gatsby-highlight[data-language='noLineNumbers'] .prism-code{padding-top:1rem;}.css-daw71u .token{display:inline-block;}.css-daw71u p>code,.css-daw71u li>code{background-color:var(--theme-ui-colors-gray-2);color:var(--theme-ui-colors-gray-8);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:2px;}.css-daw71u .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;background-color:rgb(1, 22, 39);border-radius:2px;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-daw71u .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-daw71u .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-daw71u .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-daw71u .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-daw71u .gatsby-highlight pre code{float:left;min-width:100%;}.css-daw71u .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 0.25rem 0.25rem;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.025rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}.css-daw71u .gatsby-highlight pre[class~="language-javascript"]:before,.css-daw71u .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-daw71u .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-daw71u .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-daw71u .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-daw71u .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-rust"]:before{content:"rust";background:#777bb3;color:var(--theme-ui-colors-black);}.css-daw71u .gatsby-highlight pre[class~="language-py"]:before,.css-daw71u .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-daw71u .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-daw71u .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-daw71u .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-daw71u .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-daw71u .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-daw71u .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-daw71u .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-daw71u .gatsby-highlight pre[class~='language-json']:before,.css-daw71u .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-daw71u .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-daw71u .gatsby-highlight>code[class*="language-"],.css-daw71u .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-daw71u .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-daw71u .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-daw71u .gatsby-highlight pre::-webkit-scrollbar-track{background:rgb(1, 22, 39);}.css-daw71u .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-daw71u .code-title{background-color:#d2c7ec;color:var(--theme-ui-colors-black);font-size:0.875rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-daw71u .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-daw71u .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-daw71u .code-title{margin-left:-1rem;margin-right:-1rem;}}.css-daw71u [data-name='live-preview'],.css-daw71u [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}@media screen and (min-width: 640px){.css-daw71u [data-name='live-preview'],.css-daw71u [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}}@media screen and (min-width: 768px){.css-daw71u [data-name='live-preview'],.css-daw71u [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1.25rem;}}@media screen and (min-width: 1024px){.css-daw71u [data-name='live-preview'],.css-daw71u [data-name='live-editor']{margin-left:-1rem;margin-right:-1rem;}}.css-daw71u .token-line{padding-right:1rem;}.css-daw71u .highlight-line{background-color:rgb(2, 55, 81);border-left:4px solid rgb(2, 155, 206);}.css-daw71u .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-daw71u .react-live-wrapper{position:relative;}.css-daw71u .react-live-wrapper .code-copy-button{right:0;}@media screen and (min-width: 640px){.css-daw71u .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width: 768px){.css-daw71u .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width: 1024px){.css-daw71u .react-live-wrapper .code-copy-button{right:-1rem;}}</style><style data-emotion="css 158caig">.css-158caig{box-sizing:border-box;margin:0;min-width:0;}.css-158caig [data-name='live-editor']{font-size:1rem;}.css-158caig [data-name='live-editor'] textarea,.css-158caig [data-name='live-editor'] pre{padding:1rem!important;}.css-158caig [data-name='live-preview']{padding:calc(0.5rem + 10px)!important;background-color:#d2c7ec;}.css-158caig .prism-code{font-size:1rem;padding:2rem 1rem 1rem 1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-158caig .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-158caig .prism-code{font-size:1.25rem;}}.css-158caig .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-158caig .gatsby-highlight[data-language=''] .prism-code,.css-158caig .gatsby-highlight[data-language='noLineNumbers'] .prism-code{padding-top:1rem;}.css-158caig .token{display:inline-block;}.css-158caig p>code,.css-158caig li>code{background-color:var(--theme-ui-colors-gray-2);color:var(--theme-ui-colors-gray-8);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:2px;}.css-158caig .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;background-color:rgb(1, 22, 39);border-radius:2px;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-158caig .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-158caig .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-158caig .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-158caig .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-158caig .gatsby-highlight pre code{float:left;min-width:100%;}.css-158caig .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 0.25rem 0.25rem;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.025rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}.css-158caig .gatsby-highlight pre[class~="language-javascript"]:before,.css-158caig .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-158caig .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-158caig .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-158caig .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-158caig .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-rust"]:before{content:"rust";background:#777bb3;color:var(--theme-ui-colors-black);}.css-158caig .gatsby-highlight pre[class~="language-py"]:before,.css-158caig .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-158caig .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-158caig .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-158caig .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-158caig .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-158caig .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-158caig .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-158caig .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-158caig .gatsby-highlight pre[class~='language-json']:before,.css-158caig .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-158caig .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-158caig .gatsby-highlight>code[class*="language-"],.css-158caig .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-158caig .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-158caig .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-158caig .gatsby-highlight pre::-webkit-scrollbar-track{background:rgb(1, 22, 39);}.css-158caig .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-158caig .code-title{background-color:#d2c7ec;color:var(--theme-ui-colors-black);font-size:0.875rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-158caig .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-158caig .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-158caig .code-title{margin-left:-1rem;margin-right:-1rem;}}.css-158caig [data-name='live-preview'],.css-158caig [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}@media screen and (min-width: 640px){.css-158caig [data-name='live-preview'],.css-158caig [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}}@media screen and (min-width: 768px){.css-158caig [data-name='live-preview'],.css-158caig [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1.25rem;}}@media screen and (min-width: 1024px){.css-158caig [data-name='live-preview'],.css-158caig [data-name='live-editor']{margin-left:-1rem;margin-right:-1rem;}}.css-158caig .token-line{padding-right:1rem;}.css-158caig .highlight-line{background-color:rgb(2, 55, 81);border-left:4px solid rgb(2, 155, 206);}.css-158caig .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-158caig .react-live-wrapper{position:relative;}.css-158caig .react-live-wrapper .code-copy-button{right:0;}@media screen and (min-width: 640px){.css-158caig .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width: 768px){.css-158caig .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width: 1024px){.css-158caig .react-live-wrapper .code-copy-button{right:-1rem;}}</style><main id="skip-nav" class=" css-158caig"><style data-emotion="css 1aue9xx">.css-1aue9xx{box-sizing:border-box;margin:0;min-width:0;font-family:inherit;font-weight:700;line-height:1.25;font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:2.25rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-1aue9xx{font-size:3rem;}}@media screen and (min-width: 768px){.css-1aue9xx{font-size:3rem;}}@media screen and (min-width: 1024px){.css-1aue9xx{font-size:4rem;}}</style><h1 class="css-1aue9xx">The costs of laziness</h1><style data-emotion="css 15ce8we">.css-15ce8we{color:var(--theme-ui-colors-secondary);margin-top:1rem;font-size:1rem;}.css-15ce8we a{color:var(--theme-ui-colors-secondary);}@media screen and (min-width: 640px){.css-15ce8we{font-size:1rem;}}@media screen and (min-width: 768px){.css-15ce8we{font-size:1.25rem;}}</style><p class="css-15ce8we"><time>16.03.2023</time> — <a class="css-bpdkdn" href="/tags/rust">Rust</a>, <a class="css-bpdkdn" href="/tags/performance">Performance</a>, <a class="css-bpdkdn" href="/tags/async">Async</a>, <a class="css-bpdkdn" href="/tags/distibuted-systems">Distibuted Systems</a> — <span>4<!-- --> min read</span></p><style data-emotion="css b56ay0">.css-b56ay0{margin-top:4rem;margin-bottom:4rem;}.css-b56ay0 .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;box-shadow:rgba(0, 0, 0, 0.15) 0px 32px 32px 0px,rgba(0, 0, 0, 0.15) 0px 16px 16px 0px,rgba(0, 0, 0, 0.15) 0px 8px 8px 0px,rgba(0, 0, 0, 0.15) 0px 4px 4px 0px;}@media screen and (min-width: 640px){.css-b56ay0 .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;}}@media screen and (min-width: 768px){.css-b56ay0 .gatsby-resp-image-wrapper{margin-top:4rem;margin-bottom:4rem;}}</style><section class="css-b56ay0"><style data-emotion="css 1u31ba2">.css-1u31ba2{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:2.25rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-1u31ba2{font-size:3rem;}}@media screen and (min-width: 768px){.css-1u31ba2{font-size:3rem;}}@media screen and (min-width: 1024px){.css-1u31ba2{font-size:4rem;}}</style><h1 class="css-1u31ba2"></h1><style data-emotion="css 1ccrm8j">.css-1ccrm8j{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width: 640px){.css-1ccrm8j{font-size:1rem;}}@media screen and (min-width: 768px){.css-1ccrm8j{font-size:1.25rem;}}</style><p class="css-1ccrm8j">Lazy evaluation is a concept that appears in multiple branches of computer science.
It is the idea to pre-emptively do less work and defer the computation until it is needed, as opposed to eager evaluation.
The problem with such technique is that it can have noticeable overheads such as bookkeeping.
I won&#x27;t talk about laziness in the context of Haskell as I&#x27;m not qualified and the internet is already filled with that.</p><p class="css-1ccrm8j">It is often introduced as a functional programming concept but it also exists in the C-family programming languages.
Functions are lazy by nature, function pointers (and lambdas or closures) by themselves do nothing -- until called.</p><p class="css-1ccrm8j">Let&#x27;s set the stage with an example, suppose we need to add tracing to some application that processes a list of objects.
One way of implementing this is the following:</p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><style data-emotion="css dybovu">.css-dybovu{background-color:rgba(107,70,193,0.2);border:none;color:var(--theme-ui-colors-gray-2);cursor:pointer;font-size:14px;font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";letter-spacing:0.025rem;-webkit-transition:default;transition:default;position:absolute;top:0;right:0;z-index:1;border-radius:0 0 0 0.25rem;padding:0.25rem 0.6rem;}@media screen and (min-width: 640px){.css-dybovu{font-size:14px;}}@media screen and (min-width: 768px){.css-dybovu{font-size:16px;}}.css-dybovu[disabled]{cursor:not-allowed;}.css-dybovu:not([disabled]):hover{background-color:var(--theme-ui-colors-primary);color:var(--theme-ui-colors-white);}</style><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<style data-emotion="css 15vf505">.css-15vf505{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">fn trace(condition: bool, message: String) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    if condition {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        println!(&quot;{}&quot;, message);</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">}</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">fn consume(objects: Vec&lt;Object&gt;) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">    for obj in objects {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">        trace(obj.id % N == 0, format!(&quot;consumed {} objects&quot;, obj.id));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        trace(obj.is_defective(), format!(&quot;{} is defective&quot;, obj));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">The above code may appear sensible as it is DRY and encapsulates the tracing logic inside a function.
But, it has a major flaw that won&#x27;t be catched by the compiler.</p><p class="css-1ccrm8j">-- </p><p class="css-1ccrm8j">For each iteration of the loop, the program will construct the message as if the condition happened.<br/>
<!-- -->The message has to materialize before being passed as an argument.
This has dramatic performance consequences and is probably not what the programmer intended.  </p><p class="css-1ccrm8j">One way of fixing this is to use higher order functions, by wrapping the message in a closure, the message won&#x27;t be eagerly executed at the call site but only when required.</p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">fn trace(condition: bool, message: impl FnOnce() -&gt; String) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    if condition {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        println!(&quot;{}&quot;, message());</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">}</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">fn consume(objects: Vec&lt;Object&gt;) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">    for obj in objects {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">        trace(obj.id % N == 0, || format!(&quot;consumed {} objects&quot;, obj.id));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        trace(obj.is_defective(), || format!(&quot;{} is defective&quot;, obj));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">This works, but it would be preferable to have a type that encapsulates the formatting logic and only materializes the message when needed, and that is exactly what <code class="css-0">Arguments</code> is.  </p><p class="css-1ccrm8j">It is a lazy structure that represents the formatted message, it is also faster than our string producing closure since, by virtue of laziness, prevents intermediate string allocation and writes directly to the writer.  </p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">fn trace(condition: bool, message: std::fmt::Arguments) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    if condition {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        println!(&quot;{}&quot;, message);</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">}</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">fn consume(objects: Vec&lt;Object&gt;) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">    for obj in objects {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">        trace(obj.id % N == 0, { format_args!(&quot;consumed {} objects&quot;, obj.id) });</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        trace(obj.is_defective(), format_args!(&quot;{} is defective&quot;, obj));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">Actually this is not the only lazy construct used in the code above, let&#x27;s desugar the for loop.</p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">fn consume(objects: Vec&lt;Object&gt;) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    match IntoIterator::into_iter(objects) {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        mut iterator =&gt; loop {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">            match iterator.next() {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">                None =&gt; break,</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">                Some(obj) =&gt; {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">                    trace(obj.id % N == 0, { format_args!(&quot;consumed {} objects&quot;, obj.id) });</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">                    trace(obj.is_defective(), format_args!(&quot;{} is defective&quot;, obj));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">                }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">            }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">The code might seem cryptic but you could notice that each iteration of the loop requires a function call: <code class="css-0">next()</code>; iteration is also lazy!
The advantage of using lazy iteration is that it allows partial consumption (e.g. break), this could save unnecessary work and allow the usage of infinite data structures like <code class="css-0">Range</code>.<br/>
<!-- -->It relates to the iterator design pattern which is an increasingly popular feature in programming languages.</p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">pub trait Iterator {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    type Item;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">This kind of abstraction seems to trade-off performance for readability but it is actually a zero runtime cost abstraction.
As everything is statically dispatched, the compiler is allowed to aggressively inline and optimize the code.
This is not guaranteed but it has rarely generated bad assembly in my experience.<br/>
<!-- -->This abstraction enables the composition of simple transformations on iterators which would be clunkier in an imperative style, for example:</p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">/// finds the first element a + b = c + d</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">/// where a, b, c, d are cubes</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">/// in constant memory</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">fn taxicab_two() -&gt; Option&lt;usize&gt; {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">    let cube = |i: usize| i * i * i;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">    (0..)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        .map(|i| {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            (</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">                (cube(i), (0..i).map(cube)),</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">                (i + 1..).map(|j| (cube(j), (0..j).map(cube))),</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">            )</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">        })</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">        .find_map(|(targets, candidates)| {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain">            let (a, mut bs) = targets;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">            bs.find_map(|b| {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">                let target = a + b;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">                candidates</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain">                    .clone() // at worse a memcpy</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">                    .take_while(|&amp;(c, _)| c &lt;= target)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain">                    .find_map(|(c, ds)| {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">                        ds.map(|d| c + d)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">                            .skip_while(|&amp;candidate| candidate &lt; target)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">                            .next()</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">25</span><span class="token plain">                            .filter(|&amp;candidate| candidate == target)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">26</span><span class="token plain">                    })</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">27</span><span class="token plain">            })</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">28</span><span class="token plain">        })</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">29</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">It can get kind of messy with nested iterators but in the common case they&#x27;re a pleasure to work with!</p><p class="css-1ccrm8j">Another benefit of this API is that it guarantees (in the common case of <code class="css-0">slice::Iter</code>) sequential access.
This forces the user to write code that is friendlier to the hardware due cache locality and memory prefetching, while also making it easier for the compiler to autovectorize and remove bound checks.</p><p class="css-1ccrm8j">One problem I haven&#x27;t mentioned yet about lazy evaluation is debugging.<br/>
<!-- -->As the computation starts only when required, it is possible to end up with a very deep computation DAG making it tough to debug errors and extremely hard to solve performance regressions.<br/>
<!-- -->Nonetheless, laziness leads to better code generation as the compiler has complete information of the computation, this is very apparent for processing engines like Spark.    </p><p class="css-1ccrm8j">Laziness can also appear for data structures, a common implementation of priority queue is a binary heap.<br/>
<!-- -->Let&#x27;s look at the following code: </p><div class="gatsby-highlight" data-language="rust"><pre class="prism-code language-rust" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-dybovu">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="language-rust"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">fn top_k&lt;T: Ord&gt;(seq: impl IntoIterator&lt;Item = T&gt;, k: usize) -&gt; impl Iterator&lt;Item = T&gt; {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">    seq.into_iter()</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        .collect::&lt;BinaryHeap&lt;_&gt;&gt;()</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">        .into_iter_sorted()</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        .take(k)</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">}</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">#[cfg(test)]</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">mod tests {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">    use super::*;</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">    #[test]</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">    fn it_works() {</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">        let array = [7, 22, 11, 34, 17, 52, 26, 13, 40, 20, 10, 5, 16, 8, 4, 2, 1];</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain">        assert!(top_k(array, 3).eq([52, 40, 34]));</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">}</span></div></code></pre></div><p class="css-1ccrm8j">The <code class="css-0">top_k</code> function builds a binary heap and yields an iterator that lazily pops the top element at most k times.
So the function takes a linear amount of time if unused and costs an extra logarithm for each iteration (i.e. <code class="css-0">next()</code>) of the output iterator.
Most of that work is spent maintaining the heap invariant.</p><p class="css-1ccrm8j">When that biggest element is popped, the data structure has to move things around to keep the invariant valid, but if we know that the heap is popping an element for the last time, we&#x27;re wasting time!  </p><p class="css-1ccrm8j">This could be solved by having a function on the binary heap that consumes (i.e. takes ownership) of the data structure and returns the top most element in constant time... but algorithms rarely know when that would happen.</p><p class="css-1ccrm8j">One solution is to use a lazy variant of binary heaps, lazy fibonacci heaps and the like!<br/>
<!-- -->Instead of resolving the invariant immediately, it defers the work until necessary.<br/>
<!-- -->This allows a better amortized complexity for common operations.  </p><p class="css-1ccrm8j">In practice, it is very hard to beat the vector backed binary heap due the low amount of overhead; nevertheless, it might be a good data structure for specific workloads like graph algorithms.</p><p class="css-1ccrm8j">--</p><p class="css-1ccrm8j">The generalization of iterators for distributed systems are pull-based systems.
Just like iterators, the consumer must synchronize with the producer in order to receive data, in our case it was the <code class="css-0">next()</code> function call but it can also be an rpc call, it is said that the consumer is polling for data.  </p><p class="css-1ccrm8j">But at a network boundary, the latency to resolve a function is in the order of milliseconds which is lifetimes in CPU time, it would be a waste to stay idle in the meantime.<br/>
<!-- -->This problem is what made asynchronous programming so prevalent in modern programming.</p><p class="css-1ccrm8j">Async functions can be written like regular functions, but it must use await for each blocking call.
By doing so, the executor could yield back and use CPU time to advance a ready task!<br/>
<!-- -->To know when previously awaited tasks are ready, the executor must continuously poll the operating system for ready tasks through the <code class="css-0">poll</code> system call.
Internally, each async function maintains a lazy structure that represents the perfect state machine to store just enough information to continue the execution later. </p><p class="css-1ccrm8j">Streams unify both concepts, it is a trait for objects that can produce a sequence of elements asynchronously.
One apparent problem is that the consumer has to continuously poll to receive elements. For synchronous iterators this latency problem of polling was eliminated by inlining the <code class="css-0">next()</code> function call. For asynchronous iterators that cost can&#x27;t be ignored.  </p><p class="css-1ccrm8j">This leads us to the dual, push systems! Here the producer and consumer(s) no longer synchronize, the producer keeps creating elements and sends them to the consumer without the round-trip cost of pull systems.
It is easy to see that a producer outpacing a consumer could be problematic as the consumer might drop elements at best or crash at worst. This explains why Kafka (pull) has a higher latency than RabbitMQ (push), however, RabbitMQ latencies degrade significantly at throughputs higher than 30 MB/s.</p></section></main><footer></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/the-costs-of-laziness";window.___webpackCompilationHash="4a6f44246b021de492a3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c814875c06d23b17ee2b.js"],"app":["/app-6f56ea85923a70985c17.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx-5bcc85942ea8ab68ec1e.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx-f02089026400fec9e8c6.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-3fe88f9d0bc9a5d9f408.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx-632b263f21ee586812ef.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx-4b941d34a9e322b65399.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-cbfefd32aa7dd41befd8.js"]};/*]]>*/</script><script src="/polyfill-c814875c06d23b17ee2b.js" nomodule=""></script><script src="/app-6f56ea85923a70985c17.js" async=""></script><script src="/framework-b93e9b3b15354a4a47e0.js" async=""></script><script src="/webpack-runtime-b2c16a4ef0d577137f1a.js" async=""></script></body></html>